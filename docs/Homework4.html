<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Homework 4 – LLN Simulation</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>

  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#f5f5f7; color:#1d1d1f; margin:0; padding:0; }
    header { text-align:center; padding:2rem 1rem; }
    h1 { margin:0; font-size:1.8rem; }
    .wrap { max-width:1000px; margin:1rem auto; padding:1rem; }
    .card { background:#fff; padding:1.5rem; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); margin-bottom:1.5rem; }
    textarea { width:100%; box-sizing:border-box; padding:0.75rem; border:1px solid #ccc; border-radius:8px; resize:vertical; font-size:1rem; }
    button { margin:0.5rem 0.2rem; padding:0.6rem 1.2rem; border:none; background:#0b66ff; color:#fff; border-radius:8px; cursor:pointer; font-weight:500; transition:background .25s; }
    button:hover { background:#005bb5; }
    pre { background:#f0f0f0; padding:1rem; border-radius:8px; white-space:pre-wrap; overflow-x:auto; max-height:300px; }
    .info-box { background:#eef2ff; padding:1rem; border-left:4px solid #6366f1; border-radius:8px; margin:1.5rem 0; }
    .row { display:flex; gap:1rem; flex-wrap:wrap; }
    .col { flex:1; min-width:280px; }
    table { width:100%; border-collapse:collapse; margin-top:0.75rem;}
    th, td { padding:6px 8px; border-bottom:1px solid #eee; font-size:0.95rem; text-align:left; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    footer { text-align:center; margin:2rem 0; font-size:0.9rem; color:#86868b; }
    canvas { margin-top:1rem; width:100%; height:260px; }
    .back-button {display: block;text-align: center;width: fit-content;margin: 2rem auto 0;padding: 0.75rem 1.5rem;background-color: #6e6e73;color: #fff;text-decoration: none;font-weight: 500;font-size: 1rem;border-radius: 12px;box-shadow: 0 4px 12px rgba(0,0,0,0.15);transition: all 0.25s ease;}
    .back-button:hover {background-color: #5e5e63;box-shadow: 0 6px 16px rgba(0,0,0,0.2);transform: translateY(-2px);}
  </style>
</head>
<body>
  <header>
    <h1>Homework 4 – LLN, Law of Large Numbers Simulation</h1>
  </header>

  <div class="card">
    <h2>Law of Large Numbers Simulation</h2>
    <p>Simulate relative frequencies over multiple trajectories to observe convergence towards probability <strong>p</strong>.</p>
    <label>Probability p: <input id="probP" type="number" step="0.01" value="0.5" min="0" max="1"></label>
    <label>Trajectories m: <input id="numM" type="number" value="50" min="1"></label>
    <label>Trials n: <input id="numN" type="number" value="500" min="1"></label>
    <button id="btnRunLLN">Run LLN Simulation</button>
  </div>

  <div class="info-box">
    <h3>About this Simulation</h3>
    <p>
      This interactive tool illustrates the <strong>Law of Large Numbers (LLN)</strong>.  
      Each trajectory represents a sequence of <em>n</em> independent Bernoulli trials with a probability of success <em>p</em>.  
      The relative frequency <em>f(n)</em> (successes divided by total trials) is plotted for each trajectory.  
      As the number of trials increases, all trajectories converge toward the theoretical probability <em>p</em>, confirming the LLN.  
      The histogram on the right shows the empirical distribution of the final <em>f(n)</em> values across all trajectories, which becomes increasingly concentrated near <em>p</em> as <em>n</em> grows.
    </p>
  </div>

  <div class="row">
    <div class="col card">
      <h3>Trajectories f(n)</h3>
      <canvas id="chartTrajectories"></canvas>
    </div>
    <div class="col card">
      <h3>Histogram of final f(n)</h3>
      <canvas id="chartHistogram"></canvas>
    </div>
  </div>

  <a class="back-button" href="../index.html">← Back</a>

  <footer>
    © 2025 Gabriele Paladini — All rights reserved.
  </footer>

  <script>
    let chartTraj = null;
    let chartHist = null;

    function simulateLLN(p, m, n){
      const trajectories = [];
      for(let i=0;i<m;i++){
        let success=0;
        const fValues=[];
        for(let t=1;t<=n;t++){
          if(Math.random()<p) success++;
          fValues.push(success/t);
        }
        trajectories.push(fValues);
      }
      return trajectories;
    }

    function createHistogram(finalValues, bins=20){
      const min = Math.min(...finalValues);
      const max = Math.max(...finalValues);
      const binWidth = (max-min)/bins;
      const counts = new Array(bins).fill(0);
      for(let v of finalValues){
        let idx = Math.floor((v-min)/binWidth);
        if(idx>=bins) idx=bins-1;
        counts[idx]++;
      }
      const labels = counts.map((_,i)=>(min + i*binWidth).toFixed(3));
      return {labels, counts};
    }

    document.getElementById('btnRunLLN').addEventListener('click', ()=>{
      const p = parseFloat(document.getElementById('probP').value);
      const m = parseInt(document.getElementById('numM').value);
      const n = parseInt(document.getElementById('numN').value);

      const traj = simulateLLN(p,m,n);

      const datasets = traj.map((arr,i)=>({
        label:`Trajectory ${i+1}`,
        data: arr,
        borderColor:`rgba(0,100,255,0.25)`,
        borderWidth:1,
        fill:false,
        pointRadius:0
      }));

      const lineP = {
        label:`Theoretical p = ${p}`,
        data: Array(n).fill(p),
        borderColor:'rgba(255,0,0,0.8)',
        borderWidth:2,
        borderDash:[6,4],
        fill:false,
        pointRadius:0
      };
      datasets.push(lineP);

      if(chartTraj) chartTraj.destroy();
      const ctxT = document.getElementById('chartTrajectories').getContext('2d');
      chartTraj = new Chart(ctxT,{
        type:'line',
        data:{labels:Array.from({length:n},(_,i)=>i+1), datasets},
        options:{
          responsive:true,
          plugins:{title:{display:true,text:`Law of Large Numbers - f(n) trajectories (p=${p})`}, legend:{display:false}},
          scales:{
            y:{min:0,max:1,title:{display:true,text:'Relative frequency f(n)'}},
            x:{title:{display:true,text:'Trial number n'}}
          }
        }
      });

      const finalValues = traj.map(arr=>arr[arr.length-1]);
      const hist = createHistogram(finalValues,20);
      if(chartHist) chartHist.destroy();
      const ctxH = document.getElementById('chartHistogram').getContext('2d');
      chartHist = new Chart(ctxH,{
        type:'bar',
        data:{
          labels:hist.labels,
          datasets:[{
            label:'Frequency of f(n_final)',
            data:hist.counts,
            backgroundColor:'rgba(255,99,132,0.6)'
          }]
        },
        options:{
          responsive:true,
          plugins:{title:{display:true,text:'Distribution of final f(n) over trajectories'}},
          scales:{
            y:{title:{display:true,text:'Count'}},
            x:{title:{display:true,text:'f(n_final)'}}
          }
        }
      });
    });
  </script>
</body>
</html>
